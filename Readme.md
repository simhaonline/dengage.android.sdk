
# Dengege Android SDK Setup

  

#### **Requirements**
 1. Google Firebase App Configuration
 2. Android Studio
 3. Android Device or Emulator

**dEngage Android SDK** provides an interface which handles push notification messages easily. Optionally, It also gives to send event functionality such as open and subscription to dEngage Platform.

*Supports Android API level 4.1.x or higher.*

 1. [Create Firebase App](#1-create-firebase-app)
 2.  [Configuration](#2-configuration)
 3. [Defining Push Application](#3-defining-push-application)
 4.  [Implementing the SDK](#4-implementing-the-sdk)
 5. [Using the SDK](#5-using-the-sdk)

## 1. Create Firebase App

**1.1** Create an Android app on Firebase Console. https://console.firebase.google.com/u/1/project/{project}/overview

![](./images/CreateAppStep1.png)

![](./images/CreateAppStep2.png)

**1.2** Download your configuration file  (googles-services.json) and copy the file on your app directory.

![](./images/DownloadConfigFile.png)
![](./images/CopyConfig.png)

**1.3** Add the following dependencies to ***build.gradle*** file which is located in your project root directory and sync.

    buildscript {  
        repositories {  
            mavenCentral()  
            ...    
        }  
        dependencies {  
            classpath 'com.android.tools.build:gradle:3.5.2'  
            classpath 'com.google.gms:google-services:4.2.0'  // Add this line
      }  
    }  
      
    allprojects {  
        repositories {  
            mavenCentral()  
            ...
        }  
    }
      
    apply plugin: 'com.google.gms.google-services' // Add this line
  
**1.4** Add the following dependencies to ***build.gradle*** file which is located in your project app directory and sync:
	
    apply plugin: 'com.android.application'
    ...
    dependencies {  
       ...
      implementation 'com.google.firebase:firebase-core:17.0.1'  // Add this line
      implementation 'com.google.firebase:firebase-messaging:19.0.1'  // Add this line
      implementation 'com.google.firebase:firebase-analytics:17.2.0' // Add this line
      implementation 'com.dengage.sdk:dengage-android:1.0.0' // Add this line
      ...
    }
    ...

**1.5** Run your app and verify your configuration.

![](./images/CompleteAppCreate.png)


## 2. Configuration

**2.1**  If you prefer to handle messages by dEngage, paste the following config values into your AndroidManifest.xml file. Thus all incoming push messages that received from dEngage Platform will be generated by the SDK.

```xml
<application ...>
...
	<service android:name="com.dengage.sdk.MessagingService">
		<intent-filter>
			<action  android:name="com.google.firebase.MESSAGING_EVENT"/>
		</intent-filter>
	</service>
	<activity android:name="com.dengage.sdk.OpenerActivity">  
		<intent-filter> 
			<category android:name="android.intent.category.LAUNCHER" />  
		</intent-filter>
	</activity>
...
</application>
```
**2.2** Make sure that your app has the following permissions.

```xml
<manifest ...>  
...
 <uses-permission android:name="android.permission.INTERNET" />  
 <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
 ...
</manifest>
```

## 3. Defining Push Application

**2.1** Login your dEngage Panel. Navigate "Settings>Push Applications" page and click the "Add > Android Application" button. 

![](./images/NavigateApplications.png)

**2.2** Visit your project settings page on Firebase Console and navigate to Cloud Messaging page. Copy your Server key and Sender ID.

![](./images/CopySenderKey.png)

**2.3** Paste your Server Key and Sender ID on your dEngage app settings page.

![](./images/PasteSenderKey.png)

**2.4** You'll see an integration key which is automatically generated. Keep the key for next steps.
  
## 4. Implementing the SDK
 
**4.1**  Create DengageManager instance on your main or launcher activity. 

```java
final String integrationKey = "YOUR_INTEGRATION_KEY";  

@Override  
protected void onCreate(Bundle savedInstanceState) {  
  super.onCreate(savedInstanceState);  
  setContentView(R.layout.activity_main); 
  ...
  Context context = getApplicationContext();  
  DengageManager.setLogStatus(true);  
  DengageManager.setConfig(integrationKey, context);  
  ...
}
```

After these steps, You will be able to send a push notification message to your app.


## 5. Using the SDK

**Setting Your User Contact Key** 
to set user contact key, please use the following methods. This action requires sync() function call to notify dEngage Platform.

```java
DengageManager.setContactKey("{user_contact_key}");
DengageManager.syncSubscription();
```

**Sending a Custom Event to Dengage** 
to send custom event, please use the following sample code.

```java
Map<String, Object> details = new  HashMap<>();
details.put("your_column_name", "your_column_value");
DengageManager.sendCustomEvent("event_table_name", "your_event_key", details);
```

**Sending Device Event to Dengage** 
to send device event, please use the following sample code.

```java
Map<String, Object> details = new  HashMap<>();
details.put("your_column_name", "your_column_value");
DengageManager.sendDeviceEvent("event_table_name", details);
``` 
 **Sending Open Event** 
 to send open event, please use the following sample code.

```java
Message message = new Message(intent.getExtras()); // dengage push message payload.
DengageManager.sendOpenEvent(message);
``` 
